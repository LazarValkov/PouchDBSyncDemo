<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../bower_components/paper-dropdown-menu/paper-dropdown-menu-shared-styles.html">
<link rel="import" href="../bower_components/paper-dropdown-menu/paper-dropdown-menu-icons.html">
<link rel="import" href="../bower_components/paper-dropdown-menu/paper-dropdown-menu-light.html">
<link rel="import" href="../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">


<link rel="import" href="shared-styles.html">

<dom-module id="my-view1">
  <template>
    <style include="shared-styles">
      :host {
        display: block;
        padding: 10px;
      }
      #loginErrorDiv {
        font-weight: bold;
        color: red;
      }

    </style>

    <div class="card">
      <h1>Login</h1>

      <!--<paper-input id="username" label="Your username"></paper-input>
      <div id="loginErrorDiv"></div>-->
      <paper-dropdown-menu id="logindropdown" label="Select your slack name">
        <paper-listbox class="dropdown-content">
          <paper-item>lv</paper-item>
          <paper-item>danield</paper-item>
          <paper-item>hptruong93</paper-item>
          <paper-item>lcharlin</paper-item>
          <paper-item>mliakata</paper-item>
          <paper-item>ravenscroftj</paper-item>
          <paper-item>taimur</paper-item>
          <paper-item>valerio</paper-item>
          <paper-item>yeewhye</paper-item>
        </paper-listbox>
      </paper-dropdown-menu>
      <div id="loginErrorDiv"></div>
      <br/>
      <br/>
      <paper-button id="submitButton" raised noink on-tap="_submit">Login</paper-button>
    </div>

  </template>


  <script>
    Polymer({
      is: 'my-view1',
      properties: {
        route: {
          type: Object,
          notify: true
        },
        username: {
          type: String,
          notify: true
        }
      },
      _submit: function(e) {
        var logindropdown = this.$.logindropdown;
        var selectedItem = logindropdown.selectedItem;

        if(selectedItem == null) {
          this.$.loginErrorDiv.innerHTML = "Please select your slack name.";
          return;
        }
        this.username = selectedItem.innerHTML;
        console.log("selected : " + this.username);
        this.set('route.path', '/view2/');
/*
        var loginElements = new Object();

        loginElements.submitButton = this.$.submitButton;
        loginElements.loginErrorDiv = this.$.loginErrorDiv;
        loginElements.usernameInput = this.$.username;
        loginElements.this = this;

        loginElements.loginErrorDiv.innerHTML = "";
        loginElements.submitButton.disabled = true;

        var postData = "username=" + username;
        var uriEncodedPostData = encodeURI(postData);

        /**Create a Request**/
/*        var callbackfunction = this._onFormRequestLoad;

        var rq = new Object();
        rq.loginElements = loginElements;
        rq.uriEncodedPostData = uriEncodedPostData;
        rq.onLoad = function(e) {
          callbackfunction(e, loginElements)
        };
        rq.onError = function(e) {
          loginElements.submitButton.disabled = false;
        }

        /**Send the Request**/
/*        var xhr = new XMLHttpRequest();
        xhr.addEventListener('load', rq.onLoad.bind(this));
        xhr.addEventListener('error', rq.onError.bind(this));
        xhr.open("POST", "https://leggetter-cors.herokuapp.com/", true);
        xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        xhr.send(rq.uriEncodedPostData);
*/
      }/*,

      _onFormRequestLoad: function(e, loginElements) {
        //if the status is 200 (OK), then the login has been successful
        var status = e.target.status;
        var responseText = e.target.responseText;
        if(status!=200) {
          loginElements.loginErrorDiv.innerHTML = responseText;
          loginElements.submitButton.disabled = false;
          return;
        }
        // loginElements.profiledata.login(e.target.responseText);
        loginElements.submitButton.disabled = false;
        console.log("everything was successful!");
        loginElements.this.set('route.path', '/view3/');
      }
*/
    });
  </script>
</dom-module>
